// Probe wc_ChaCha20Poly1305_Encrypt inside libwolfssl.so by offset
uprobe:/mnt/linuxstorage/wolfssl/src/.libs/libwolfssl.so:0x607db
{
  printf("=== HIT wc_ChaCha20Poly1305_Encrypt pid=%d tid=%d comm=%s ===\n", pid, tid, comm);

  // Freeze the process so /proc/<pid>/... stays valid
  system("kill -STOP %d 2>/dev/null", pid);

  // Dump context while it's stopped
  system("readlink /proc/%d/exe > /tmp/exe.%d 2>/dev/null", pid, pid);
  system("cat /proc/%d/maps > /tmp/maps.%d 2>/dev/null", pid, pid);

  // Confirm dumps aren't empty
  system("wc -c /tmp/exe.%d /tmp/maps.%d 2>/dev/null", pid, pid);

  // Resume
  system("kill -CONT %d 2>/dev/null", pid);

  // Print stack for call chain
  print(ustack(30));

  // Remove this if you want to capture multiple hits
  exit();
}
